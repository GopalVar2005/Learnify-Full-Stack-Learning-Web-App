<% layout('layouts/boilerplate') %>

<%- include('../partials/navbar') %>    
<%- include('../partials/flash') %>    

<div class="container mt-4">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-4">Student Dashboard</h1>
      <p class="text-muted">Welcome back, <%=currentUser.username%>! Track your learning progress here.</p>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Total Enrolled</h5>
          <h2 class="text-primary"><%=totalEnrolled%></h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title">In Progress</h5>
          <h2 class="text-warning"><%=inProgressCourses ? inProgressCourses.length : 0%></h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Completed</h5>
          <h2 class="text-success"><%=completedCourses ? completedCourses.length : 0%></h2>
        </div>
      </div>
    </div>
  </div>

  <!-- In Progress Courses -->
  <% if(inProgressCourses && inProgressCourses.length > 0){ %>
    <div class="row mb-4">
      <div class="col-12">
        <h3 class="mb-3">Courses In Progress</h3>
        <div class="row">
          <% inProgressCourses.forEach(item => { %>
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow-sm h-100">
                <img src="<%=item.course.img%>" class="card-img-top" alt="<%=item.course.name%>" style="height: 200px; object-fit: cover;">
                <div class="card-body">
                  <h5 class="card-title"><%=item.course.name%></h5>
                  <p class="text-muted small">₹<%=item.course.price%></p>
                  
                  <!-- Progress Bar -->
                  <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                      <small class="text-muted">Progress</small>
                      <small class="text-muted"><%=item.completedLessons%> / <%=item.totalLessons%> lessons</small>
                    </div>
                    <div class="progress" style="height: 20px;">
                      <div class="progress-bar bg-success" role="progressbar" style="width: <%=item.progressPercentage%>%" aria-valuenow="<%=item.progressPercentage%>" aria-valuemin="0" aria-valuemax="100">
                        <%=item.progressPercentage%>%
                      </div>
                    </div>
                  </div>
                  
                  <a href="/courses/<%=item.course._id%>" class="btn btn-primary btn-sm w-100">Continue Learning</a>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      </div>
    </div>
  <% } %>

  <!-- Completed Courses -->
  <% if(completedCourses && completedCourses.length > 0){ %>
    <div class="row mb-4">
      <div class="col-12">
        <h3 class="mb-3">Completed Courses</h3>
        <div class="row">
          <% completedCourses.forEach(item => { %>
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow-sm h-100 border-success">
                <img src="<%=item.course.img%>" class="card-img-top" alt="<%=item.course.name%>" style="height: 200px; object-fit: cover;">
                <div class="card-body">
                  <h5 class="card-title"><%=item.course.name%></h5>
                  <p class="text-muted small">₹<%=item.course.price%></p>
                  
                  <div class="mb-3">
                    <span class="badge bg-success">✓ Completed</span>
                    <% if(item.progress && item.progress.completedAt){ %>
                      <small class="text-muted d-block mt-1">Completed on: <%=new Date(item.progress.completedAt).toLocaleDateString()%></small>
                    <% } %>
                  </div>
                  
                  <a href="/courses/<%=item.course._id%>" class="btn btn-outline-primary btn-sm w-100">View Course</a>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      </div>
    </div>
  <% } %>

  <!-- No Courses Message -->
  <% if((!inProgressCourses || inProgressCourses.length === 0) && (!completedCourses || completedCourses.length === 0)){ %>
    <div class="row">
      <div class="col-12">
        <div class="alert alert-info text-center">
          <h5>No enrolled courses yet</h5>
          <p>Start learning by enrolling in a course!</p>
          <a href="/courses" class="btn btn-primary">Browse Courses</a>
        </div>
      </div>
    </div>
  <% } %>
</div>

</body>
</html>

